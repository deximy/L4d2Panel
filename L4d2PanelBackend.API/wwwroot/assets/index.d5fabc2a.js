import{r as $,o as D,c as L,d as q,a as d,H as W,U as X,b as M,x as Y,e as J,n as P,f as Q,g as Z,h as ee,w as x,i as te,u as v,N as le,s as ne,j as re,k as oe,l as h,m as ae,p as se,q as ie,t as _,v as S,y as k,z as ce,A as ue,B as fe,C as de,D as pe,E as _e,F as me}from"./vendor.34115501.js";const ve=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function c(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerpolicy&&(e.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?e.credentials="include":o.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function r(o){if(o.ep)return;o.ep=!0;const e=c(o);fetch(o.href,e)}};ve();var N=(l,t)=>{const c=l.__vccOpts||l;for(const[r,o]of t)c[r]=o;return c};const ye={};function he(l,t){const c=$("router-view");return D(),L(c)}var we=N(ye,[["render",he]]);const p=q("store",()=>{const l=d(""),t=d(""),c=d(!1),r=d(""),o=d(""),e=d("./");return{endpoint:l,component:t,is_server_running:c,selected_file_name:r,selected_file_type:o,current_path:e}}),ge=async()=>{p();let l="/processes/",t=await(await fetch(l,{method:"GET"})).json();return t.length==0?!1:(l+=t[0],(await(await fetch(l,{method:"GET"})).json()).exit_time===null)};setInterval(()=>{ge().then(l=>p().is_server_running=l)},1e3);const be=async()=>{p();let l="/hub";return new W().withUrl(l).build()},ke=async l=>{p();let t="/files/"+l;return await(await fetch(t)).json()},T=async l=>{p();let t="/files/"+l;return await fetch(t,{method:"POST"})},O=async(l,t,c,r)=>{p();let o="/upload",e=new X(l,{endpoint:o,retryDelays:[0,3e3,5e3,1e4,2e4],metadata:{name:l.name,contentType:l.type||"application/octet-stream",emptyMetaKey:"",location:t},onError:function(a){console.log("Failed because: "+a),r()},onProgress:function(a,y){let w=(a/y*100).toFixed(2);console.log(e.file.name,a,y,w+"%")},onSuccess:function(){console.log("Succeed. Download %s from %s",e.file.name,e.url),c()}});e.findPreviousUploads().then(function(a){a.length&&e.resumeFromPreviousUpload(a[0]),e.start()})},U=async l=>{p();let t="/files/"+l;return await fetch(t,{method:"DELETE"})};const xe=M({emits:["OnCommitCommand"],setup(l,{emit:t}){const c=d();let r="",o=new Array;const e=new Y.exports.Terminal({rendererType:"canvas",convertEol:!0,disableStdin:!1,cursorBlink:!0,scrollback:0}),a=new J.exports.FitAddon;e.loadAddon(a),e.onKey(f=>{const u=f.domEvent,E=!u.altKey&&!u.ctrlKey&&!u.metaKey;if(console.log(u.code,e.buffer),u.code==="Enter"||u.code==="NumpadEnter"){if(r.replace(/^\s+|\s+$/g,"").length!=0){t("OnCommitCommand",r),o.push(r);for(let C of r)e.write("\b \b");r=""}}else u.code==="Backspace"?(e.write("\b \b"),r=r.slice(0,r.length-1)):u.code==="ArrowLeft"?e.write(f.key):u.code==="ArrowRight"?e.buffer.active.cursorX<r.length&&e.write(f.key):E&&(e.write(f.key),r+=f.key)}),be().then(f=>{f.on("ReceiveMessage",u=>{e.writeln(u)}),f==null||f.start().then(()=>{}).catch(u=>{console.log(u)})});let y=new ResizeObserver(()=>{P().then(()=>{a.fit()})});Q(()=>{if(c.value===void 0)throw new Error("Cannot find terminal element!");e.open(c.value),y.observe(c.value)}),Z(()=>{y.disconnect()});const w=ee(()=>p().is_server_running);return(f,u)=>(D(),L(v(le),{class:"loading",show:!v(w),stroke:"#66CCFF"},{default:x(()=>[te("div",{class:"terminal",ref_key:"terminal_element",ref:c},null,512)]),_:1},8,["show"]))}});var Ee=N(xe,[["__scopeId","data-v-f1276280"]]);const Ce={class:"file_manager"},Fe=M({setup(l){const t=p(),c=[{key:"file_type",fixed:"left",width:"0",className:"file_type_icon",render:n=>n.file_type==="directory"?_("div",{class:"file_type_icon_wrapper"},_(S,{},{default:()=>[_("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},_("path",{d:"M10.59 4.59C10.21 4.21 9.7 4 9.17 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-1.41-1.41z",fill:"currentColor"}))]})):_("div",{class:"file_type_icon_wrapper"},_(S,{},{default:()=>[_("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},_("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z",fill:"currentColor"}))]}))},{title:"\u6587\u4EF6\u540D",key:"file_name",className:"file_name"}],r=d([]),o=n=>({onDblclick:s=>{n.file_type==="directory"?y(n.file_name):n.file_type==="file"?w(n.file_name):console.error("Unknown file type!")},onContextmenu:s=>{s.preventDefault(),g.value=!1,t.selected_file_type=n.file_type,t.selected_file_name=n.file_name,C.value=s.clientX,B.value=s.clientY,P().then(()=>{g.value=!0})}});let{current_path:e}=ne(t);const a=async n=>{let s=await ke(n);if(s===void 0){console.log("Empty response!");return}r.value.length=0,r.value.push({key:"directory_..",file_type:"directory",file_name:".."});for(let i of s.directories)r.value.push({key:"directory_"+i,file_type:"directory",file_name:i});for(let i of s.files)r.value.push({key:"file_"+i,file_type:"file",file_name:i})},y=async n=>{e.value=k.join(e.value,n),e.value.startsWith("..")&&(e.value="./")},w=async n=>{console.log("Try to open file: "+n)},f=()=>{F.value=!0},u=async n=>{await U(k.join(e.value,n)),await a(e.value)},E=async n=>{await U(k.join(e.value,n)),await a(e.value)};re(e,n=>{a(n)}),a(e.value);const C=d(0),B=d(0),j=[{label:"\u5237\u65B0",key:"refresh"},{label:"\u65B0\u5EFA\u6587\u4EF6\u5939",key:"mkdir"},{label:"\u4E0A\u4F20\u6587\u4EF6",key:"upload_file"},{label:"\u4E0A\u4F20\u6587\u4EF6\u5939",key:"upload_directory"},{label:()=>_("span",{style:{color:"red"}},"\u5220\u9664"),key:"delete"}],g=d(!1),I=()=>{g.value=!1},K=(n,s)=>{if(g.value=!1,s==="refresh")a(e.value);else if(s==="mkdir")f();else if(s==="upload_file"){let i=document.getElementsByClassName("n-upload-file-input");if(i.length==0)throw new RangeError("Couldn't find file input!");i[0].removeAttribute("webkitdirectory"),n()}else if(s==="upload_directory"){let i=document.getElementsByClassName("n-upload-file-input");if(i.length==0)throw new RangeError("Couldn't find file input!");i[0].setAttribute("webkitdirectory","webkitdirectory"),n()}else s==="delete"?t.selected_file_type==="directory"?u(t.selected_file_name):t.selected_file_type==="file"?E(t.selected_file_name):console.error("Unknown file type:"+t.selected_file_type):console.error("Unknown key: "+s)},z=({file:n,onFinish:s,onError:i})=>{let m=n.file;if(m.webkitRelativePath!=""&&m.webkitRelativePath!=null){let G=m.webkitRelativePath.substring(0,m.webkitRelativePath.lastIndexOf("/")),R=k.join(e.value,G);T(R).then(()=>{O(m,R,s,i).then(()=>a(e.value))})}else O(m,e.value,s,i).then(()=>a(e.value))},F=d(!1),V=()=>{b.value!=null&&(T(k.join(e.value,b.value)).then(()=>a(e.value)),b.value=null)},b=d(null);return(n,s)=>(D(),oe("div",Ce,[h(v(ae),{class:"file_list",bordered:!1,columns:c,data:r.value,"row-props":o},null,8,["data"]),h(v(se),{abstract:"",multiple:!0,"custom-request":z},{default:x(()=>[h(v(ce),{abstract:""},{default:x(({handleClick:i})=>[h(v(ue),{placement:"bottom-start",trigger:"manual",x:C.value,y:B.value,options:j,show:g.value,onClickoutside:I,onSelect:m=>K(i,m)},null,8,["x","y","show","onSelect"])]),_:1})]),_:1}),h(v(ie),{show:F.value,"onUpdate:show":s[1]||(s[1]=i=>F.value=i),preset:"dialog",title:"\u65B0\u5EFA\u6587\u4EF6\u5939","show-icon":!1,"negative-text":"\u53D6\u6D88","positive-text":"\u786E\u8BA4","on-positive-click":V},{default:x(()=>[h(v(fe),{value:b.value,"onUpdate:value":s[0]||(s[0]=i=>b.value=i),type:"text",placeholder:"\u6587\u4EF6\u5939\u540D"},null,8,["value"])]),_:1},8,["show"])]))}});var De=N(Fe,[["__scopeId","data-v-8a957014"]]);const Ne=[{path:"terminal",name:"terminal",component:Ee,beforeEnter:()=>{H.component="terminal"}},{path:"file",name:"file",component:De,beforeEnter:()=>{H.component="file"}},{path:":path(.*)*",redirect:{name:"terminal"}}],Ae=de({history:pe(),routes:Ne}),Be=_e(),A=me(we);A.use(Ae);A.use(Be);A.mount("#app");const H=p();
